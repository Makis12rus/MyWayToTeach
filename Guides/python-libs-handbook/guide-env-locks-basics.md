# 🌱 Основы работоспособности проекта: окружение, фиксация версий и установка пакетов

## Описание
Этот гайд помогает запускать Python-проект одинаково на любой машине. Мы создадим **изолированное окружение**, чтобы пакеты проекта не мешались с системными. Затем **зафиксируем версии** зависимостей, чтобы сегодня, завтра и на CI устанавливался **один и тот же** набор библиотек. Наконец, используем надёжные инструменты установки и сборки, чтобы всё ставилось быстро и предсказуемо. Результат — воспроизводимость без «сюрпризов» при обновлениях.

## Содержание 🧭
* [uv](#uv) — сверхбыстрый менеджер проектов и пакетов с lock-файлом и управлением окружениями.
* [pip](#pip) — стандартный установщик пакетов из PyPI и других индексов.
* [venv](#venv) — встроённый модуль Python для создания изолированных виртуальных окружений.
* [pip-tools](#pip-tools) — «жёсткая» фиксация версий через `pip-compile` и синхронизация `pip-sync`.
* [Poetry](#poetry) — менеджер зависимостей и упаковки с собственным lock-файлом.
* [virtualenv](#virtualenv) — продвинутый инструмент для создания окружений с дополнительными возможностями.
* [Pipenv](#pipenv) — связка pip + virtualenv с `Pipfile` и `Pipfile.lock` для воспроизводимых установок.
* [build](#build) — сборка `sdist` и `wheel` в изоляции по `pyproject.toml`.
* [wheel](#wheel) — формат бинарных пакетов и утилита для быстрых установок.
* [setuptools](#setuptools) — распространённый build-backend и инструменты упаковки.
* [Hatch](#hatch) — современный менеджер проекта: окружения, резолвинг, сборка и публикация.
* [PDM](#pdm) — менеджер зависимостей на стандартах PEP с lock-файлом.
* [pipx](#pipx) — установка и запуск CLI-утилит из пакетов в изолированных окружениях.

## uv

**Коротко:** `uv` — сверхбыстрый менеджер проектов и пакетов для Python. В нашем процессе он используется **внутри активированного виртуального окружения** и помогает фиксировать версии (lock-файл), экспортировать «замороженные» зависимости и контролировать воспроизводимость. Устанавливаем **только через `pip` в `venv`**.

---

### 🚀 Установка в виртуальное окружение

```bash
python -m venv .venv
```

Создаёт изолированное окружение в папке `.venv` рядом с проектом.

```bash
# macOS/Linux
source .venv/bin/activate

# Windows (PowerShell)
.\.venv\Scripts\Activate.ps1
```

Активирует окружение: далее все команды и пакеты относятся только к этому проекту.

```bash
python -m pip install --upgrade pip
```

Обновляет менеджер пакетов внутри окружения, чтобы избежать старых багов и получить поддержку новых форматов колёс.

```bash
python -m pip install uv
```

Устанавливает `uv` **внутрь активированного `venv`**. Так мы не засоряем систему и соблюдаем единый подход ко всем зависимостям.

```bash
uv --version
```

Проверяет, что `uv` доступен из текущего окружения; увидите номер версии.

---

### 🧩 Описываем зависимости проекта

Создадим минимальный `pyproject.toml`, чтобы `uv` мог собрать lock-файл:

```toml
[project]
name = "myapp"
version = "0.1.0"
dependencies = [
  "requests>=2.32,<3.0"
]
```

`[project]` описывает метаданные. В `dependencies` перечисляем требования в привычном формате «имя и диапазон версий».

---

### 🔒 Генерируем lock-файл

```bash
uv lock
```

Строит и записывает `uv.lock` с конкретными версиями пакетов и транзитивных зависимостей для вашей платформы.

---

### 📤 Экспорт «замороженных» версий в requirements.txt

```bash
uv export -o requirements.txt
```

Преобразует `uv.lock` в стандартный `requirements.txt`, удобный для установки через `pip`.

---

### 📥 Устанавливаем зависимости ТОЛЬКО через pip в активированном venv

```bash
python -m pip install -r requirements.txt
```

Ставит ровно те версии, что зафиксированы в `requirements.txt` и исходно получены из `uv.lock`.

---

### ▶️ Быстрая проверка

```bash
python -c "import requests; print('__OK__', requests.__version__)"
```

Если увидите `__OK__ 2.32.x` (или близкую версию), значит окружение и фиксация версий работают.

---

### 🔁 Обновление зависимостей (контролируемо)

```bash
# 1) Меняем диапазон версии в pyproject.toml, если нужно
# 2) Пересобираем lock-файл
uv lock --upgrade
# 3) Обновляем «замороженный» список
uv export -o requirements.txt
# 4) Применяем изменения строго внутри venv
python -m pip install -r requirements.txt
```

Так мы получаем новые версии осознанно, без «самопроизвольных» обновлений.

---

### 🧰 Полезные команды

```bash
uv tree        # показать дерево зависимостей по lock-файлу
uv version     # прочитать/обновить версию проекта из pyproject.toml
uv help export # краткая справка по экспорту
```

Короткие команды для диагностики и контроля без отклонения от принципа «устанавливаем через pip в venv».

